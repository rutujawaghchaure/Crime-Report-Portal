<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crime Reporting System</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="main.css">
  <!-- Include jsPDF library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head> 
<body>

  <nav class="navbar">
    <div class="nav-container">
        <a href="#" class="logo">
            <i class="fas fa-shield-alt"></i>
            Crime Report Portal
        </a>
        <div class="mobile-menu">
            <i class="fas fa-bars"></i>
        </div>
        <div class="nav-links">
            <a href="Main.html"><i class="fas fa-home"></i> Home</a>
            <a href="#"><i class="fas fa-hands-helping"></i> Services</a>
            <a href="#report"><i class="fas fa-file-alt"></i> Report Crime</a>
            <a href="#statistics"><i class="fas fa-chart-bar"></i> Statistics</a>
            <a href="#contact"><i class="fas fa-envelope"></i> Contact</a>
        </div>
    </div>
</nav>

<div class="con" style="display: flex;flex-direction: column;justify-items: center; align-items: center; margin-top: 9rem; margin-bottom: 10px;">
  <div class="container">
    <h1>Crime Reporting System</h1>
    <form id="crime-form">
      
      <!-- Complainant Details -->
      <h3>Complainant Details</h3>
      <label for="complainant-name">Name:</label>
      <input type="text" id="complainant-name" name="complainant-name" required>

      <label for="father-husband-name">Father's/Husband's Name:</label>
      <input type="text" id="father-husband-name" name="father-husband-name" required>

      <label for="complainant-address">Address:</label>
      <input type="text" id="complainant-address" name="complainant-address" required>

      <label for="contact-number">Contact Number:</label>
      <input type="tel" id="contact-number" name="contact-number" required>

      <!-- Police Station Details -->
      <h3>Police Station Details</h3>
      <label for="police-station">Police Station:</label>
      <input type="text" id="police-station" name="police-station" required>

      <label for="district">District:</label>
      <input type="text" id="district" name="district" required>

      <!-- Date and Time of Occurrence -->
      <h3>Date and Time of Occurrence</h3>
      <label for="occurrence-date">Exact Date:</label>
      <input type="date" id="occurrence-date" name="occurrence-date" required>

      <label for="occurrence-time">Exact Time:</label>
      <input type="time" id="occurrence-time" name="occurrence-time" required>

      <!-- Place of Occurrence -->
      <h3>Place of Occurrence</h3>
      <label for="place-of-occurrence">Detailed Address:</label>
      <input type="text" id="place-of-occurrence" name="place-of-occurrence" required>

      <label for="distance-direction">Distance and Direction from Police Station:</label>
      <input type="text" id="distance-direction" name="distance-direction" required>

      <!-- Nature of Offense -->
      <h3>Nature of Offense</h3>
      <label for="offense-description">Description of Offense:</label>
      <textarea id="offense-description" name="offense-description" required></textarea>

      <label for="ipc-sections">Relevant IPC Sections:</label>
      <input type="text" id="ipc-sections" name="ipc-sections" required>

      <!-- Details of Accused -->
      <h3>Details of Accused</h3>
      <label for="accused-name">Accused Name:</label>
      <input type="text" id="accused-name" name="accused-name">

      <label for="accused-address">Accused Address:</label>
      <input type="text" id="accused-address" name="accused-address">

      <label for="accused-description">Accused Description:</label>
      <textarea id="accused-description" name="accused-description"></textarea>

      <!-- Witness Details -->
      <h3>Witness Details</h3>
      <label for="witness-names">Witness Names:</label>
      <input type="text" id="witness-names" name="witness-names">

      <label for="witness-addresses">Witness Addresses:</label>
      <input type="text" id="witness-addresses" name="witness-addresses">

      <!-- Description of Incident -->
      <h3>Description of Incident</h3>
      <label for="incident-description">Detailed Account of Incident:</label>
      <textarea id="incident-description" name="incident-description" required></textarea>

      <!-- Items Lost or Damaged -->
      <h3>Items Lost or Damaged</h3>
      <label for="items-lost-damaged">Description of Items:</label>
      <textarea id="items-lost-damaged" name="items-lost-damaged"></textarea>

      <!-- Complainant's Statement -->
      <h3>Complainant's Statement</h3>
      <label for="complainant-statement">Statement:</label>
      <textarea id="complainant-statement" name="complainant-statement" required></textarea>

      <!-- Signature and Thumb Impression -->
      <h3>Signature & Thumb Impression</h3>
      <label for="signature">Signature:</label>
      <input type="text" id="signature" name="signature" required>

      <label for="thumb-impression">Thumb Impression:</label>
      <input type="file" id="thumb-impression" name="thumb-impression">

      <button type="submit">Generate FIR</button>
      <!-- <a href="./all_FIR.html" target="_blank" rel="noopener noreferrer">open all</a> -->
    </form>

    <!-- Placeholder for the download link -->
    <div id="download-link-container"></div>
  </div></div>
  <footer>
    <div class="footer-content">
        <div class="footer-section">
            <h3>Quick Links</h3>
            <a href="./Main.html">Home</a>
            <a href="#services">Services</a>
            <a href="#report">Report Crime</a>
            <a href="#contact">Contact</a>
            <a href="./all_FIR.html">All FIR DATA</a>
        </div>
        <div class="footer-section">
            <h3>Contact Us</h3>
            <p><i class="fas fa-phone"></i> Emergency: 911</p>
            <p><i class="fas fa-envelope"></i> info@crimereport.gov</p>
            <p><i class="fas fa-map-marker-alt"></i> Police HQ, City Center</p>
        </div>
        <div class="footer-section">
            <h3>Follow Us</h3>
            <div class="social-links">
                <a href="#"><i class="fab fa-facebook"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
            </div>
        </div>
    </div>
    <div class="footer-bottom">
        <p>&copy; 2025 Crime Reporting System. All rights reserved.</p>
    </div>
</footer>
  <!-- Firebase Scripts -->
  <script type="module">
    // Import Firebase SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBy_BOSqZfTFPsH6Pb_pQUP5845PJScL1Y",
      authDomain: "crimereport-6a12b.firebaseapp.com",
      projectId: "crimereport-6a12b",
      storageBucket: "crimereport-6a12b.appspot.com",
      messagingSenderId: "666218285177",
      appId: "1:666218285177:web:2289a5408ecb5d59e9eca8",
      measurementId: "G-31PKZWXBBT"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Form Submission Handler
    document.getElementById('crime-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      // Collect form data
      const complainantName = document.getElementById('complainant-name').value;
      const fatherHusbandName = document.getElementById('father-husband-name').value;
      const complainantAddress = document.getElementById('complainant-address').value;
      const contactNumber = document.getElementById('contact-number').value;

      const policeStation = document.getElementById('police-station').value;
      const district = document.getElementById('district').value;
      
      const occurrenceDate = document.getElementById('occurrence-date').value;
      const occurrenceTime = document.getElementById('occurrence-time').value;
      const placeOfOccurrence = document.getElementById('place-of-occurrence').value;
      const distanceDirection = document.getElementById('distance-direction').value;

      const offenseDescription = document.getElementById('offense-description').value;
      const ipcSections = document.getElementById('ipc-sections').value;

      const accusedName = document.getElementById('accused-name').value;
      const accusedAddress = document.getElementById('accused-address').value;
      const accusedDescription = document.getElementById('accused-description').value;

      const witnessNames = document.getElementById('witness-names').value;
      const witnessAddresses = document.getElementById('witness-addresses').value;

      const incidentDescription = document.getElementById('incident-description').value;
      const itemsLostDamaged = document.getElementById('items-lost-damaged').value;

      const complainantStatement = document.getElementById('complainant-statement').value;

      const signature = document.getElementById('signature').value;
      const thumbImpression = document.getElementById('thumb-impression').files[0];  // You can handle the file upload here if needed

      // FIR Data Object
      const firData = {
        complainant_name: complainantName,
        father_husband_name: fatherHusbandName,
        complainant_address: complainantAddress,
        contact_number: contactNumber,
        police_station: policeStation,
        district: district,
        occurrence_date: occurrenceDate,
        occurrence_time: occurrenceTime,
        place_of_occurrence: placeOfOccurrence,
        distance_direction: distanceDirection,
        offense_description: offenseDescription,
        ipc_sections: ipcSections,
        accused_name: accusedName,
        accused_address: accusedAddress,
        accused_description: accusedDescription,
        witness_names: witnessNames,
        witness_addresses: witnessAddresses,
        incident_description: incidentDescription,
        items_lost_damaged: itemsLostDamaged,
        complainant_statement: complainantStatement,
        signature: signature,
        thumb_impression: thumbImpression ? thumbImpression.name : null,  // If uploading thumb impression
        timestamp: serverTimestamp(),
      };

      try {
        await addDoc(collection(db, "fir_reports"), firData);
        alert("FIR Generated Successfully!");

        // Generate PDF after form submission
        generatePDF(firData);
      } catch (error) {
        console.error("Error adding FIR: ", error);
        alert("Error generating FIR. Please try again.");
      }
    });

    // Function to generate PDF
    function generatePDF(firData) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFontSize(16);
      doc.text("Crime Report", 14, 20);
      doc.setFontSize(12);

      let y = 30;

      doc.text(`Complainant Name: ${firData.complainant_name}`, 14, y);
      y += 10;
      doc.text(`Father/Husband Name: ${firData.father_husband_name}`, 14, y);
      y += 10;
      doc.text(`Address: ${firData.complainant_address}`, 14, y);
      y += 10;
      doc.text(`Contact Number: ${firData.contact_number}`, 14, y);
      y += 10;

      doc.text(`Police Station: ${firData.police_station}`, 14, y);
      y += 10;
      doc.text(`District: ${firData.district}`, 14, y);
      y += 10;
      doc.text(`Date of Occurrence: ${firData.occurrence_date}`, 14, y);
      y += 10;
      doc.text(`Time of Occurrence: ${firData.occurrence_time}`, 14, y);
      y += 10;
      doc.text(`Place of Occurrence: ${firData.place_of_occurrence}`, 14, y);
      y += 10;
      doc.text(`Distance and Direction: ${firData.distance_direction}`, 14, y);
      y += 10;
      doc.text(`Offense Description: ${firData.offense_description}`, 14, y);
      y += 10;
      doc.text(`IPC Sections: ${firData.ipc_sections}`, 14, y);
      y += 10;

      doc.text(`Accused Name: ${firData.accused_name}`, 14, y);
      y += 10;
      doc.text(`Accused Address: ${firData.accused_address}`, 14, y);
      y += 10;
      doc.text(`Accused Description: ${firData.accused_description}`, 14, y);
      y += 10;

      doc.text(`Witness Names: ${firData.witness_names}`, 14, y);
      y += 10;
      doc.text(`Witness Addresses: ${firData.witness_addresses}`, 14, y);
      y += 10;

      doc.text(`Incident Description: ${firData.incident_description}`, 14, y);
      y += 10;
      doc.text(`Items Lost or Damaged: ${firData.items_lost_damaged}`, 14, y);
      y += 10;
      doc.text(`Complainant Statement: ${firData.complainant_statement}`, 14, y);
      y += 10;

      doc.text(`Signature: ${firData.signature}`, 14, y);
      y += 10;
      doc.text(`Thumb Impression: ${firData.thumb_impression ? firData.thumb_impression : "N/A"}`, 14, y);

      // Generate download link
      const pdfUrl = doc.output('bloburl');
      const link = document.createElement('a');
      link.href = pdfUrl;
      link.download = `FIR_Report_${Date.now()}.pdf`;
      link.innerText = 'Download FIR PDF';
      
      document.getElementById('download-link-container').appendChild(link);
    }
  </script>
</body>
</html>
